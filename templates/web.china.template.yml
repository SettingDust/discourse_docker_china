hooks:
  before_web:
    - exec:
       cmd:
         - gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/

  before_code:
    - exec:
       cmd:
         - git config --global url."https://hub.fastgit.xyz/".insteadOf "https://github.com/"

  before_bundle_exec:
    - exec:
       cmd:
         - su discourse -c 'bundle config mirror.https://rubygems.org https://gems.ruby-china.com/'
  after_bundle_exec:
    - exec:
       cd: $home
       cmd:
         - wget https://raw.fastgit.xyz/SettingDust/discourse_docker_china/main/discourse.patch
         - git apply discourse.patch
         - yarn config set registry https://r.cnpmjs.org/
